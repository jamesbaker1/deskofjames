<!DOCTYPE html>
<html lang="en">
	<head>
		<title>James Baker</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				text-align:center;
			}
			
			/* Peaceful lake video background */
			#video-bg {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				object-fit: cover;
				z-index: 0;
				opacity: 0.5;
				pointer-events: none;
			}

			a {
				color: #fff;
				cursor: pointer;
				opacity: 0.9;
				transition: opacity 0.2s;
			}
			
			a:hover {
				opacity: 1;
			}
			
			canvas {
				position: relative;
				z-index: 1;
			}
			
			h3 {
			  text-align: center;
			}

			#info {
				position: fixed;
				top: 50%;
				left: 50%;
				-webkit-transform: translate(-50%, -50%);
				transform: translate(-50%, -50%);
				z-index: 100;
				pointer-events: auto;
				color: #fff;
				text-shadow: 0 2px 20px rgba(0,0,0,0.5), 0 0 40px rgba(0,0,0,0.3);
				letter-spacing: 0.5px;
			}
			
			#three-container {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 1;
			}
			
			#three-container canvas {
				position: absolute;
				top: 0;
				left: 0;
			}

			/* Returning visitor toast styles */
			#visitor-toast {
				position: fixed;
				bottom: 24px;
				left: 50%;
				transform: translateX(-50%) translateY(100px);
				background: rgba(10, 10, 15, 0.9);
				backdrop-filter: blur(12px);
				-webkit-backdrop-filter: blur(12px);
				padding: 16px 24px;
				border-radius: 16px;
				z-index: 9999;
				font-family: system-ui, -apple-system, sans-serif;
				font-size: 14px;
				color: #fff;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
				opacity: 0;
				transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
				display: flex;
				align-items: center;
				gap: 16px;
				max-width: 90vw;
				width: max-content;
				border: 1px solid rgba(255,255,255,0.1);
				pointer-events: none; /* Prevent clicks when hidden */
			}
			
			#visitor-toast.show {
				transform: translateX(-50%) translateY(0);
				opacity: 1;
				pointer-events: auto;
			}
			
			/* Make toast width consistent on mobile */
			@media (max-width: 600px) {
				#visitor-toast {
					width: calc(100% - 32px);
					bottom: 20px;
					justify-content: space-between;
					padding: 16px 20px;
					max-width: none;
				}
				
				#visitor-toast .toast-text {
					font-size: 13px;
				}
				
				#data-overlay {
					padding: 0;
					align-items: flex-end; /* Sheet style on mobile */
				}
				
				#data-overlay .data-container {
					border-radius: 20px 20px 0 0;
					max-height: 85vh;
					background: #141419;
					padding: 24px 20px 40px 20px;
					width: 100%;
					max-width: none;
				}
				
				#data-overlay .close-data {
					position: absolute;
					top: 16px;
					right: 16px;
					z-index: 2;
					background: rgba(255,255,255,0.1);
					padding: 8px 14px;
				}
				
				#data-overlay .stat-cards {
					gap: 8px;
				}
				
				#data-overlay .stat-card {
					padding: 16px 12px;
				}
				
				#data-overlay .stat-card .stat-value {
					font-size: 24px;
				}
			}

			#visitor-toast .toast-icon {
				font-size: 20px;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #00ff88;
			}
			
			#visitor-toast .toast-icon svg {
				width: 22px;
				height: 22px;
			}

			#visitor-toast .toast-text strong {
				color: #a5d6ff;
			}

			#visitor-toast .toast-close {
				background: none;
				border: none;
				color: #888;
				font-size: 18px;
				cursor: pointer;
				padding: 0 0 0 8px;
				transition: color 0.2s;
			}

			#visitor-toast .toast-close:hover {
				color: #fff;
			}

			#visitor-toast .toast-content {
				cursor: pointer;
				display: flex;
				align-items: center;
				gap: 12px;
			}

			#visitor-toast .toast-text {
				display: flex;
				flex-direction: column;
				gap: 2px;
				line-height: 1.4;
			}

			#visitor-toast .toast-hint {
				font-size: 11px;
				color: #666;
				opacity: 0.8;
			}

			#visitor-toast .toast-content:hover .toast-hint {
				color: #a5d6ff;
			}

			#visitor-toast .toast-content:active {
				transform: scale(0.98);
			}

			/* Full data overlay */
			#data-overlay {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(5, 5, 10, 0.95);
				z-index: 10000;
				opacity: 0;
				visibility: hidden;
				transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
				display: flex;
				align-items: flex-start; /* Fix top cutoff on scroll */
				justify-content: center;
				font-family: 'SF Mono', 'Roboto Mono', Menlo, monospace;
				overflow-y: auto;
				padding: 40px 20px;
				backdrop-filter: blur(20px);
				-webkit-backdrop-filter: blur(20px);
			}

			#data-overlay.show {
				opacity: 1;
				visibility: visible;
			}

			#data-overlay .data-container {
				max-width: 800px;
				width: 100%;
				margin: auto 0; /* Center vertically if space allows */
			}

			/* Grid Layout */
			.hud-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 20px;
				margin-top: 20px;
			}

			/* Modules */
			.hud-module {
				background: rgba(255, 255, 255, 0.03);
				border: 1px solid rgba(255, 255, 255, 0.08);
				border-radius: 4px;
				padding: 20px;
				position: relative;
				overflow: hidden;
			}
			
			.hud-module::before {
				content: '';
				position: absolute;
				top: 0; left: 0; width: 100%; height: 2px;
				background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
			}

			.module-header {
				font-size: 10px;
				text-transform: uppercase;
				letter-spacing: 2px;
				color: rgba(255, 255, 255, 0.4);
				margin-bottom: 15px;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			/* Typography */
			.hud-value {
				font-size: 24px;
				font-weight: 300;
				color: #fff;
				letter-spacing: -0.5px;
			}
			
			.hud-label {
				font-size: 12px;
				color: rgba(255, 255, 255, 0.5);
				margin-top: 4px;
			}

			.hud-detail {
				font-size: 13px;
				color: rgba(255, 255, 255, 0.8);
				display: flex;
				justify-content: space-between;
				padding: 8px 0;
				border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			}
			
			.hud-detail:last-child {
				border-bottom: none;
			}

			/* Globe / Location Visual */
			.globe-container {
				height: 150px;
				display: flex;
				align-items: center;
				justify-content: center;
				position: relative;
				margin-bottom: 10px;
			}
			
			.css-globe {
				width: 100px;
				height: 100px;
				border-radius: 50%;
				border: 1px solid rgba(255, 255, 255, 0.1);
				position: relative;
				animation: rotate 20s linear infinite;
				box-shadow: 0 0 30px rgba(0, 120, 255, 0.1) inset;
			}
			
			.css-globe::before, .css-globe::after {
				content: '';
				position: absolute;
				top: 0; left: 0; right: 0; bottom: 0;
				border-radius: 50%;
				border: 1px solid rgba(255, 255, 255, 0.1);
			}
			
			.css-globe::before { transform: rotateX(60deg); }
			.css-globe::after { transform: rotateY(60deg); }
			
			.globe-dot {
				position: absolute;
				width: 6px;
				height: 6px;
				background: #00ff88;
				border-radius: 50%;
				top: 50%; left: 50%;
				transform: translate(-50%, -50%);
				box-shadow: 0 0 10px #00ff88;
				animation: pulse 2s infinite;
			}

			/* Bars */
			.stat-bar {
				height: 4px;
				background: rgba(255, 255, 255, 0.1);
				margin-top: 8px;
				border-radius: 2px;
				overflow: hidden;
			}
			
			.stat-fill {
				height: 100%;
				background: #fff;
				width: 0%;
				transition: width 1s ease;
			}

			/* Close button */
			#data-overlay .close-data {
				position: fixed;
				top: 20px;
				right: 20px;
				background: rgba(255,255,255,0.05);
				border: 1px solid rgba(255,255,255,0.1);
				color: #fff;
				padding: 8px 16px;
				border-radius: 100px;
				cursor: pointer;
				font-family: inherit;
				font-size: 12px;
				text-transform: uppercase;
				letter-spacing: 1px;
				transition: all 0.2s;
				z-index: 100;
			}

			#data-overlay .close-data:hover {
				background: rgba(255,255,255,0.15);
				border-color: rgba(255,255,255,0.3);
			}

			@keyframes rotate {
				0% { transform: rotate(0deg); }
				100% { transform: rotate(360deg); }
			}
			
			@keyframes pulse {
				0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); }
				70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
				100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
			}
			
			@keyframes slideIn {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			/* Mobile Adaptations */
			@media (max-width: 600px) {
				.hud-grid {
					grid-template-columns: 1fr;
				}
				
				#data-overlay {
					align-items: flex-end; /* Sheet style */
					padding: 0;
					background: rgba(0,0,0,0.6);
				}
				
				#data-overlay .data-container {
					background: #0f0f13;
					border-radius: 20px 20px 0 0;
					padding: 30px 20px 40px;
					max-height: 85vh;
					overflow-y: auto;
				}
				
				#data-overlay .close-data {
					position: absolute;
					top: 15px;
					right: 15px;
					width: auto;
				}
			}
			
			/* Custom Scrollbar */
			#data-overlay::-webkit-scrollbar {
				width: 8px;
			}
			#data-overlay::-webkit-scrollbar-track {
				background: rgba(255,255,255,0.02);
			}
			#data-overlay::-webkit-scrollbar-thumb {
				background: rgba(255,255,255,0.1);
				border-radius: 4px;
			}
			#data-overlay::-webkit-scrollbar-thumb:hover {
				background: rgba(255,255,255,0.2);
			}

			/* Full-width analytics module */
			.hud-module.full-width {
				grid-column: 1 / -1;
			}

			.analytics-embed {
				width: 100%;
				min-height: 450px;
				border: none;
				border-radius: 8px;
				background: rgba(0,0,0,0.3);
			}

			.analytics-embed-container {
				position: relative;
				width: 100%;
				padding-top: 56.25%; /* 16:9 aspect ratio fallback */
				min-height: 400px;
				background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(20,20,30,0.4) 100%);
				border-radius: 8px;
				overflow: hidden;
			}

			.analytics-embed-container iframe {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: none;
			}

			/* Live indicator */
			.live-indicator {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				font-size: 10px;
				color: #00ff88;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.live-dot {
				width: 6px;
				height: 6px;
				background: #00ff88;
				border-radius: 50%;
				animation: livePulse 1.5s infinite;
			}

			@keyframes livePulse {
				0%, 100% { opacity: 1; transform: scale(1); }
				50% { opacity: 0.5; transform: scale(1.2); }
			}

			/* Referrer badge */
			.referrer-badge {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				background: rgba(255,255,255,0.08);
				padding: 6px 12px;
				border-radius: 20px;
				font-size: 12px;
				color: #fff;
				margin-top: 10px;
			}

			.referrer-badge svg {
				width: 14px;
				height: 14px;
				opacity: 0.7;
			}

			/* Engagement meter */
			.engagement-ring {
				width: 80px;
				height: 80px;
				position: relative;
				margin: 0 auto 15px;
			}

			.engagement-ring svg {
				transform: rotate(-90deg);
			}

			.engagement-ring .ring-bg {
				fill: none;
				stroke: rgba(255,255,255,0.1);
				stroke-width: 6;
			}

			.engagement-ring .ring-fill {
				fill: none;
				stroke: url(#engagementGradient);
				stroke-width: 6;
				stroke-linecap: round;
				stroke-dasharray: 220;
				stroke-dashoffset: 220;
				transition: stroke-dashoffset 1.5s ease;
			}

			.engagement-value {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 18px;
				font-weight: 600;
				color: #fff;
			}

			/* Session timeline */
			.session-timeline {
				position: relative;
				padding-left: 20px;
			}

			.session-timeline::before {
				content: '';
				position: absolute;
				left: 6px;
				top: 0;
				bottom: 0;
				width: 2px;
				background: linear-gradient(to bottom, #00ff88, rgba(0,255,136,0.1));
			}

			.timeline-event {
				position: relative;
				padding: 8px 0;
				font-size: 12px;
				color: rgba(255,255,255,0.7);
			}

			.timeline-event::before {
				content: '';
				position: absolute;
				left: -17px;
				top: 12px;
				width: 8px;
				height: 8px;
				background: #00ff88;
				border-radius: 50%;
				box-shadow: 0 0 8px rgba(0,255,136,0.5);
			}

			.timeline-event:first-child::before {
				animation: pulse 2s infinite;
			}

			.timeline-time {
				font-size: 10px;
				color: rgba(255,255,255,0.4);
				margin-top: 2px;
			}

			/* Glowing accent border on hover */
			.hud-module:hover {
				border-color: rgba(0,255,136,0.2);
				box-shadow: 0 0 20px rgba(0,255,136,0.05);
				transition: all 0.3s ease;
			}

			/* Stats counter animation */
			@keyframes countUp {
				from { opacity: 0; transform: translateY(10px); }
				to { opacity: 1; transform: translateY(0); }
			}

			.count-up {
				animation: countUp 0.5s ease forwards;
			}

			/* Scan line effect for header */
			.scan-line {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				height: 2px;
				background: linear-gradient(90deg, transparent, #00ff88, transparent);
				animation: scanMove 3s linear infinite;
			}

			@keyframes scanMove {
				0% { transform: translateX(-100%); }
				100% { transform: translateX(100%); }
			}

		</style>

		<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SD111PLQKX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SD111PLQKX');
</script>

<!-- PostHog Analytics -->
<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Xr es pi Zr rs Kr Qr capture Ni calculateEventProperties os register register_once register_for_session unregister unregister_for_session ds getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey cancelPendingSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException startExceptionAutocapture stopExceptionAutocapture loadToolbar get_property getSessionProperty us ns createPersonProfile hs Vr vs opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing ss debug O ls getPageViewId captureTraceFeedback captureTraceMetric qr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_EFLt4tZQGNYoKwwixTF7HP8iMdiSVqqAXieGDcHYlAj', {
        api_host: 'https://us.i.posthog.com',
        person_profiles: 'identified_only',
        capture_pageview: true,
        capture_pageleave: true,
        autocapture: true
    })
</script>

	</head>
	<body>
		<!-- Peaceful lake video background -->
		<video id="video-bg" autoplay muted loop playsinline>
			<source src="lak.mp4" type="video/mp4">
		</video>
		<script>
			// Skip last 5 seconds of video
			const videoBg = document.getElementById('video-bg');
			videoBg.addEventListener('timeupdate', function() {
				if (this.duration - this.currentTime <= 5) {
					this.currentTime = 0;
				}
			});
		</script>
		
		<!-- Returning visitor toast -->
		<div id="visitor-toast">
			<div class="toast-content" id="toast-content">
				<span class="toast-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></span>
				<span class="toast-text">
					<span id="toast-message"></span>
					<span class="toast-hint">see what I know about you →</span>
				</span>
			</div>
			<button class="toast-close" id="toast-close">×</button>
		</div>

		<!-- Full data overlay -->
		<div id="data-overlay">
			<button class="close-data" id="close-data">Close HUD</button>
			<div class="data-container">
				<!-- Header and content will be injected here -->
				<div id="data-content"></div>
			</div>
		</div>

		<div id="info">
			James Baker<br/>
			jamesbak@seas.upenn.edu<br/><br/>
			<a href="https://www.linkedin.com/in/jamesfrancisbaker/" target="_blank"> <img src="linkedin.png" alt="LinkedIn" height="20"></a>
			<a href="https://github.com/jamesbaker1" target="_blank"> <img src="github.png" alt="GitHub" height="20"></a>
			<a href="blog/open.html"> <img src="blog-solid.svg" alt="Blog" height="20"></a>
			<a href="https://jamesfbaker.substack.com/"> <img src="substack.png" alt="Blog" height="20"></a>
			<a href="https://scholar.google.com/citations?user=mYkMGl8AAAAJ&hl=en"> <img src="scholar.png" height="20"></>
		</div>

		<script src="js/three.js"></script>
		<script src="js/WebGL.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<script src="js/libs/dat.gui.min.js"></script>
		<script src="js/GPUComputationRenderer.js"></script>

		<!--
		TODO: If you're reading this, you may wish to improve this by
			- creating a better shading for the birds?
		-->


		<!-- shader for bird's position -->
		<script id="fragmentShaderPosition" type="x-shader/x-fragment">

			uniform float time;
			uniform float delta;

			void main()	{

				vec2 uv = gl_FragCoord.xy / resolution.xy;
				vec4 tmpPos = texture2D( texturePosition, uv );
				vec3 position = tmpPos.xyz;
				vec3 velocity = texture2D( textureVelocity, uv ).xyz;

				float phase = tmpPos.w;

				phase = mod( ( phase + delta +
					length( velocity.xz ) * delta * 3. +
					max( velocity.y, 0.0 ) * delta * 6. ), 62.83 );

				gl_FragColor = vec4( position + velocity * delta * 15. , phase );

			}

		</script>

		<script>
			function loop() {
				if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) {
			return;
			}
					var i, n, s = '';

					for (i = 0; i < 10; i++) {
							n = Math.floor(Math.sin((Date.now()/200) + (i/2)) * 4) + 4;

							s += String.fromCharCode(0x2581 + n);
					}

					window.location.hash = s;

					setTimeout(loop, 50);
			}

			// window.addEventListener('load', loop);
	</script>

		<!-- shader for bird's velocity -->
		<script id="fragmentShaderVelocity" type="x-shader/x-fragment">

			uniform float time;
			uniform float testing;
			uniform float delta; // about 0.016
			uniform float seperationDistance; // 20
			uniform float alignmentDistance; // 40
			uniform float cohesionDistance; //
			uniform float freedomFactor;
			uniform vec3 predator;

			const float width = resolution.x;
			const float height = resolution.y;

			const float PI = 3.141592653589793;
			const float PI_2 = PI * 2.0;
			// const float VISION = PI * 0.55;

			float zoneRadius = 40.0;
			float zoneRadiusSquared = 1600.0;

			float separationThresh = 0.45;
			float alignmentThresh = 0.65;

			const float UPPER_BOUNDS = BOUNDS;
			const float LOWER_BOUNDS = -UPPER_BOUNDS;

			const float SPEED_LIMIT = 9.0;

			float rand(vec2 co){
				return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
			}

			void main() {

				zoneRadius = seperationDistance + alignmentDistance + cohesionDistance;
				separationThresh = seperationDistance / zoneRadius;
				alignmentThresh = ( seperationDistance + alignmentDistance ) / zoneRadius;
				zoneRadiusSquared = zoneRadius * zoneRadius;


				vec2 uv = gl_FragCoord.xy / resolution.xy;
				vec3 birdPosition, birdVelocity;

				vec3 selfPosition = texture2D( texturePosition, uv ).xyz;
				vec3 selfVelocity = texture2D( textureVelocity, uv ).xyz;

				float dist;
				vec3 dir; // direction
				float distSquared;

				float seperationSquared = seperationDistance * seperationDistance;
				float cohesionSquared = cohesionDistance * cohesionDistance;

				float f;
				float percent;

				vec3 velocity = selfVelocity;

				float limit = SPEED_LIMIT;

				dir = predator * UPPER_BOUNDS - selfPosition;
				dir.z = 0.;
				// dir.z *= 0.6;
				dist = length( dir );
				distSquared = dist * dist;

				float preyRadius = 150.0;
				float preyRadiusSq = preyRadius * preyRadius;


				// move birds away from predator
				if (dist < preyRadius) {

					f = ( distSquared / preyRadiusSq - 1.0 ) * delta * 100.;
					velocity += normalize( dir ) * f;
					limit += 5.0;
				}


				// if (testing == 0.0) {}
				// if ( rand( uv + time ) < freedomFactor ) {}


				// Attract flocks to the center
				vec3 central = vec3( 0., 0., 0. );
				dir = selfPosition - central;
				dist = length( dir );

				dir.y *= 2.5;
				velocity -= normalize( dir ) * delta * 5.;

				for (float y=0.0;y<height;y++) {
					for (float x=0.0;x<width;x++) {

						vec2 ref = vec2( x + 0.5, y + 0.5 ) / resolution.xy;
						birdPosition = texture2D( texturePosition, ref ).xyz;

						dir = birdPosition - selfPosition;
						dist = length(dir);

						if (dist < 0.0001) continue;

						distSquared = dist * dist;

						if (distSquared > zoneRadiusSquared ) continue;

						percent = distSquared / zoneRadiusSquared;

						if ( percent < separationThresh ) { // low

							// Separation - Move apart for comfort
							f = (separationThresh / percent - 1.0) * delta;
							velocity -= normalize(dir) * f;

						} else if ( percent < alignmentThresh ) { // high

							// Alignment - fly the same direction
							float threshDelta = alignmentThresh - separationThresh;
							float adjustedPercent = ( percent - separationThresh ) / threshDelta;

							birdVelocity = texture2D( textureVelocity, ref ).xyz;

							f = ( 0.5 - cos( adjustedPercent * PI_2 ) * 0.5 + 0.5 ) * delta;
							velocity += normalize(birdVelocity) * f;

						} else {

							// Attraction / Cohesion - move closer
							float threshDelta = 1.0 - alignmentThresh;
							float adjustedPercent = ( percent - alignmentThresh ) / threshDelta;

							f = ( 0.5 - ( cos( adjustedPercent * PI_2 ) * -0.5 + 0.5 ) ) * delta;

							velocity += normalize(dir) * f;

						}

					}

				}



				// this make tends to fly around than down or up
				// if (velocity.y > 0.) velocity.y *= (1. - 0.2 * delta);

				// Speed Limits
				if ( length( velocity ) > limit ) {
					velocity = normalize( velocity ) * limit;
				}

				gl_FragColor = vec4( velocity, 1.0 );

			}

		</script>

		<script type="x-shader/x-vertex" id="birdVS">

			attribute vec2 reference;
			attribute float birdVertex;

			attribute vec3 birdColor;

			uniform sampler2D texturePosition;
			uniform sampler2D textureVelocity;

			varying vec4 vColor;
			varying float z;

			uniform float time;

			void main() {

				vec4 tmpPos = texture2D( texturePosition, reference );
				vec3 pos = tmpPos.xyz;
				vec3 velocity = normalize(texture2D( textureVelocity, reference ).xyz);

				vec3 newPosition = position;

				if ( birdVertex == 4.0 || birdVertex == 7.0 ) {
					// flap wings
					newPosition.y = sin( tmpPos.w ) * 5.;
				}

				newPosition = mat3( modelMatrix ) * newPosition;


				velocity.z *= -1.;
				float xz = length( velocity.xz );
				float xyz = 1.;
				float x = sqrt( 1. - velocity.y * velocity.y );

				float cosry = velocity.x / xz;
				float sinry = velocity.z / xz;

				float cosrz = x / xyz;
				float sinrz = velocity.y / xyz;

				mat3 maty =  mat3(
					cosry, 0, -sinry,
					0    , 1, 0     ,
					sinry, 0, cosry

				);

				mat3 matz =  mat3(
					cosrz , sinrz, 0,
					-sinrz, cosrz, 0,
					0     , 0    , 1
				);

				newPosition =  maty * matz * newPosition;
				newPosition += pos;

				z = newPosition.z;

				vColor = vec4( birdColor, 1.0 );
				gl_Position = projectionMatrix *  viewMatrix  * vec4( newPosition, 1.0 );
			}

		</script>

		<!-- bird geometry shader -->
		<script type="x-shader/x-fragment" id="birdFS">

			varying vec4 vColor;
			varying float z;

			uniform vec3 color;

			void main() {
				// Fake colors for now
				float z2 = 0.2 + ( 1000. - z ) / 1000. * vColor.x;
				gl_FragColor = vec4( z2, z2, z2, 1. );

			}

		</script>


		<script>

			if ( WEBGL.isWebGLAvailable() === false ) {

				document.body.appendChild( WEBGL.getWebGLErrorMessage() );

			}

			// var hash = document.location.hash.substr( 1 );
			var hash = 10;
			if ( hash ) hash = parseInt( hash, 0 );

			/* TEXTURE WIDTH FOR SIMULATION */
			var WIDTH = hash || 32;

			var BIRDS = WIDTH * WIDTH;

			// Custom Geometry - using 3 triangles each. No UVs, no normals currently.
			THREE.BirdGeometry = function () {

				var triangles = BIRDS * 3;
				var points = triangles * 3;

				THREE.BufferGeometry.call( this );

				var vertices = new THREE.BufferAttribute( new Float32Array( points * 3 ), 3 );
				var birdColors = new THREE.BufferAttribute( new Float32Array( points * 3 ), 3 );
				var references = new THREE.BufferAttribute( new Float32Array( points * 2 ), 2 );
				var birdVertex = new THREE.BufferAttribute( new Float32Array( points ), 1 );

				this.addAttribute( 'position', vertices );
				this.addAttribute( 'birdColor', birdColors );
				this.addAttribute( 'reference', references );
				this.addAttribute( 'birdVertex', birdVertex );

				// this.addAttribute( 'normal', new Float32Array( points * 3 ), 3 );


				var v = 0;

				function verts_push() {

					for ( var i = 0; i < arguments.length; i ++ ) {

						vertices.array[ v ++ ] = arguments[ i ];

		}

	}

				var wingsSpan = 20;

				for ( var f = 0; f < BIRDS; f ++ ) {

					// Body
					verts_push(
						0, - 0, - 20,
						0, 4, - 20,
						0, 0, 30
					);

					// Left Wing
					verts_push(
						0, 0, - 15,
						- wingsSpan, 0, 0,
						0, 0, 15
					);

					// Right Wing
					verts_push(
						0, 0, 15,
						wingsSpan, 0, 0,
						0, 0, - 15
					);

				}

				for ( var v = 0; v < triangles * 3; v ++ ) {

					var i = ~ ~ ( v / 3 );
					var x = ( i % WIDTH ) / WIDTH;
					var y = ~ ~ ( i / WIDTH ) / WIDTH;

					var c = new THREE.Color(
						0x444444 +
						~ ~ ( v / 9 ) / BIRDS * 0x666666
					);

					birdColors.array[ v * 3 + 0 ] = c.r;
					birdColors.array[ v * 3 + 1 ] = c.g;
					birdColors.array[ v * 3 + 2 ] = c.b;

					references.array[ v * 2 ] = x;
					references.array[ v * 2 + 1 ] = y;

					birdVertex.array[ v ] = v % 9;

				}

				this.scale( 0.2, 0.2, 0.2 );

			};

			THREE.BirdGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );


			var container, stats;
			var camera, scene, renderer, i;
			var mouseX = 0, mouseY = 0;

			// Gyroscope support for mobile
			var tiltX = 0, tiltY = 0;
			var useGyroscope = false;
			var gyroscopeAvailable = false;
			var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var BOUNDS = 800, BOUNDS_HALF = BOUNDS / 2;

			// document.getElementById( 'birds' ).innerText = BIRDS;

			function change( n ) {

				location.hash = n;
				location.reload();
				return false;

}


			var options = '';
			for ( i = 1; i < 7; i ++ ) {

				var j = Math.pow( 2, i );
				options += '<a href="#" onclick="return change(' + j + ')">' + ( j * j ) + '</a> ';

}
			// document.getElementById( 'options' ).innerHTML = options;

			var last = performance.now();

			var gpuCompute;
			var velocityVariable;
			var positionVariable;
			var positionUniforms;
			var velocityUniforms;
			var birdUniforms;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				container.id = 'three-container';
				container.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;';
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 3000 );
				camera.position.z = 350;

				scene = new THREE.Scene();
				scene.background = null; // Transparent to show video behind
				scene.fog = new THREE.Fog( 0xffffff, 100, 1000 );

				renderer = new THREE.WebGLRenderer({ alpha: true });
				renderer.setClearColor( 0x000000, 0 ); // Transparent clear
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				initComputeRenderer();

				// stats = new Stats();
				// container.appendChildf( stats.dom );

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );
				document.addEventListener( 'touchmove', onDocumentTouchMove, false );
				document.addEventListener( 'touchend', onDocumentTouchEnd, false );

				// Initialize gyroscope for mobile
				if (isMobile) {
					initGyroscope();
				}

				//

				window.addEventListener( 'resize', onWindowResize, false );



				// var gui = new dat.GUI();


				var effectController = {
					seperation: 20.0,
					alignment: 20.0,
					cohesion: 20.0,
					freedom: 0.75
				};

				var valuesChanger = function () {

					velocityUniforms.seperationDistance.value = effectController.seperation;
					velocityUniforms.alignmentDistance.value = effectController.alignment;
					velocityUniforms.cohesionDistance.value = effectController.cohesion;
					velocityUniforms.freedomFactor.value = effectController.freedom;

				};

				valuesChanger();


				// gui.add( effectController, "seperation", 0.0, 100.0, 1.0 ).onChange( valuesChanger );
				// gui.add( effectController, "alignment", 0.0, 100, 0.001 ).onChange( valuesChanger );
				// gui.add( effectController, "cohesion", 0.0, 100, 0.025 ).onChange( valuesChanger );
				// gui.close();

				initBirds();

			}

			function initComputeRenderer() {

    				gpuCompute = new GPUComputationRenderer( WIDTH, WIDTH, renderer );

				var dtPosition = gpuCompute.createTexture();
				var dtVelocity = gpuCompute.createTexture();
				fillPositionTexture( dtPosition );
				fillVelocityTexture( dtVelocity );

				velocityVariable = gpuCompute.addVariable( "textureVelocity", document.getElementById( 'fragmentShaderVelocity' ).textContent, dtVelocity );
				positionVariable = gpuCompute.addVariable( "texturePosition", document.getElementById( 'fragmentShaderPosition' ).textContent, dtPosition );

				gpuCompute.setVariableDependencies( velocityVariable, [ positionVariable, velocityVariable ] );
				gpuCompute.setVariableDependencies( positionVariable, [ positionVariable, velocityVariable ] );

				positionUniforms = positionVariable.material.uniforms;
				velocityUniforms = velocityVariable.material.uniforms;

				positionUniforms.time = { value: 0.0 };
				positionUniforms.delta = { value: 0.0 };
				velocityUniforms.time = { value: 1.0 };
				velocityUniforms.delta = { value: 0.0 };
				velocityUniforms.testing = { value: 1.0 };
				velocityUniforms.seperationDistance = { value: 1.0 };
				velocityUniforms.alignmentDistance = { value: 1.0 };
				velocityUniforms.cohesionDistance = { value: 1.0 };
				velocityUniforms.freedomFactor = { value: 1.0 };
				velocityUniforms.predator = { value: new THREE.Vector3() };
				velocityVariable.material.defines.BOUNDS = BOUNDS.toFixed( 2 );

				velocityVariable.wrapS = THREE.RepeatWrapping;
				velocityVariable.wrapT = THREE.RepeatWrapping;
				positionVariable.wrapS = THREE.RepeatWrapping;
				positionVariable.wrapT = THREE.RepeatWrapping;

				var error = gpuCompute.init();
				if ( error !== null ) {

				    console.error( error );

	}

			}

			function initBirds() {

				var geometry = new THREE.BirdGeometry();

				console.log("Want to know how I made this? Shoot me an email at jamesbak@seas.upenn.edu");
				// For Vertex and Fragment
				birdUniforms = {
					color: { value: new THREE.Color( 0xff2200 ) },
					texturePosition: { value: null },
					textureVelocity: { value: null },
					time: { value: 1.0 },
					delta: { value: 0.0 }
				};

				// ShaderMaterial
				var material = new THREE.ShaderMaterial( {
					uniforms: birdUniforms,
					vertexShader: document.getElementById( 'birdVS' ).textContent,
					fragmentShader: document.getElementById( 'birdFS' ).textContent,
					side: THREE.DoubleSide

				} );

				var birdMesh = new THREE.Mesh( geometry, material );
				birdMesh.rotation.y = Math.PI / 2;
				birdMesh.matrixAutoUpdate = false;
				birdMesh.updateMatrix();

				scene.add( birdMesh );

			}

			function fillPositionTexture( texture ) {

				var theArray = texture.image.data;

				for ( var k = 0, kl = theArray.length; k < kl; k += 4 ) {

					var x = Math.random() * BOUNDS - BOUNDS_HALF;
					var y = Math.random() * BOUNDS - BOUNDS_HALF;
					var z = Math.random() * BOUNDS - BOUNDS_HALF;

					theArray[ k + 0 ] = x;
					theArray[ k + 1 ] = y;
					theArray[ k + 2 ] = z;
					theArray[ k + 3 ] = 1;

				}

			}

			function fillVelocityTexture( texture ) {

				var theArray = texture.image.data;

				for ( var k = 0, kl = theArray.length; k < kl; k += 4 ) {

					var x = Math.random() - 0.5;
					var y = Math.random() - 0.5;
					var z = Math.random() - 0.5;

					theArray[ k + 0 ] = x * 10;
					theArray[ k + 1 ] = y * 10;
					theArray[ k + 2 ] = z * 10;
					theArray[ k + 3 ] = 1;

				}

			}


			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				mouseX = event.clientX - windowHalfX;
				mouseY = event.clientY - windowHalfY;

			}

			var touchOverride = false;
			var touchOverrideTimeout;

			function onDocumentTouchStart( event ) {

				if ( event.touches.length === 1 ) {

					event.preventDefault();

					mouseX = event.touches[ 0 ].pageX - windowHalfX;
					mouseY = event.touches[ 0 ].pageY - windowHalfY;

					// Temporarily override gyroscope with touch
					if (gyroscopeAvailable) {
						touchOverride = true;
						clearTimeout(touchOverrideTimeout);
					}

				}

			}

			function onDocumentTouchMove( event ) {

				if ( event.touches.length === 1 ) {

					event.preventDefault();

					mouseX = event.touches[ 0 ].pageX - windowHalfX;
					mouseY = event.touches[ 0 ].pageY - windowHalfY;

				}

			}

			function onDocumentTouchEnd( event ) {
				// Return to gyroscope control after touch ends (with small delay)
				if (gyroscopeAvailable && touchOverride) {
					touchOverrideTimeout = setTimeout(function() {
						touchOverride = false;
					}, 500);
				}
			}

			// Gyroscope functions for mobile
			var iosPermissionRequested = false;
			
			function initGyroscope() {
				// Check if DeviceOrientationEvent is available
				if (typeof DeviceOrientationEvent !== 'undefined') {
					// iOS 13+ requires permission
					if (typeof DeviceOrientationEvent.requestPermission === 'function') {
						// Request permission on first tap anywhere
						document.addEventListener('touchstart', requestIOSPermission, { once: true });
					} else {
						// Android and other devices - just add the listener
						enableGyroscope();
						showGyroHint();
					}
				}
			}

			function requestIOSPermission() {
				if (iosPermissionRequested) return;
				iosPermissionRequested = true;
				
				DeviceOrientationEvent.requestPermission()
					.then(function(response) {
						if (response === 'granted') {
							enableGyroscope();
							showGyroHint(); // Show confirmation hint
						}
					})
					.catch(function(error) {
						console.error('Gyroscope permission error:', error);
					});
			}

			function enableGyroscope() {
				window.addEventListener('deviceorientation', handleDeviceOrientation, true);
				gyroscopeAvailable = true;
				useGyroscope = true;
				console.log('Gyroscope enabled - tilt your device to control the birds!');
			}
			
			function showGyroHint() {
				var hint = document.createElement('div');
				hint.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>Tilt to move birds';
				hint.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:10px 20px;background:rgba(0,0,0,0.7);color:#fff;border-radius:20px;font-family:system-ui,-apple-system,sans-serif;font-size:13px;z-index:1000;opacity:0;transition:opacity 0.5s ease;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);';
				document.body.appendChild(hint);
				
				// Fade in
				setTimeout(function() { hint.style.opacity = '1'; }, 100);
				
				// Fade out and remove
				setTimeout(function() {
					hint.style.opacity = '0';
					setTimeout(function() { hint.remove(); }, 500);
				}, 3000);
			}

			function handleDeviceOrientation(event) {
				if (!useGyroscope) return;
				
				// gamma: left-right tilt (-90 to 90)
				// beta: front-back tilt (-180 to 180)
				var gamma = event.gamma || 0; // Left-right
				var beta = event.beta || 0;   // Front-back
				
				// Normalize and clamp values
				// gamma: -45 to 45 degrees mapped to full range
				// beta: 0 to 90 degrees (assuming phone held upright, tilting forward)
				
				// Clamp gamma to -45 to 45 range
				gamma = Math.max(-45, Math.min(45, gamma));
				// Adjust beta (subtract ~45 to center when phone is held at angle)
				beta = Math.max(-45, Math.min(45, beta - 45));
				
				// Map to the same range as mouse (-windowHalf to windowHalf)
				// Increased sensitivity for more dramatic bird movement
				tiltX = (gamma / 45) * windowHalfX * 1.5;
				tiltY = (beta / 45) * windowHalfY * 1.5;
			}

			//

			function animate() {

				requestAnimationFrame( animate );

				render();
				// stats.update();

			}

			function render() {

				var now = performance.now();
				var delta = ( now - last ) / 1000;

				if ( delta > 1 ) delta = 1; // safety cap on large deltas
				last = now;

				positionUniforms.time.value = now;
				positionUniforms.delta.value = delta;
				velocityUniforms.time.value = now;
				velocityUniforms.delta.value = delta;
				birdUniforms.time.value = now;
				birdUniforms.delta.value = delta;

				// Use gyroscope on mobile if available (unless touch is overriding)
				if (useGyroscope && gyroscopeAvailable && !touchOverride) {
					// Gyroscope provides continuous values, use them directly
					velocityUniforms.predator.value.set( 0.5 * tiltX / windowHalfX, - 0.5 * tiltY / windowHalfY, 0 );
				} else {
					velocityUniforms.predator.value.set( 0.5 * mouseX / windowHalfX, - 0.5 * mouseY / windowHalfY, 0 );
					mouseX = 10000;
					mouseY = 10000;
				}

				gpuCompute.compute();

				birdUniforms.texturePosition.value = gpuCompute.getCurrentRenderTarget( positionVariable ).texture;
				birdUniforms.textureVelocity.value = gpuCompute.getCurrentRenderTarget( velocityVariable ).texture;

				renderer.render( scene, camera );

			}

		</script>

		<!-- Returning visitor tracking script -->
		<script>
		(function() {
			const VISIT_KEY = 'jb_visits';
			const LAST_VISIT_KEY = 'jb_last_visit';

			// Get stored data
			let visitCount = parseInt(localStorage.getItem(VISIT_KEY) || '0');
			const lastVisit = localStorage.getItem(LAST_VISIT_KEY);

			// Update visit data
			visitCount++;
			localStorage.setItem(VISIT_KEY, visitCount.toString());
			localStorage.setItem(LAST_VISIT_KEY, new Date().toISOString());

			// Track in PostHog
			if (window.posthog) {
				posthog.capture('page_view', {
					visit_count: visitCount,
					returning_visitor: visitCount > 1
				});
			}

			// Get timezone city name
			const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
			const city = tz.split('/').pop().replace(/_/g, ' ');

			// Build message based on visit count and data we know
			function getMessage() {
				let msg = '';
				const hour = new Date().getHours();
				
				if (visitCount === 1) {
					// First time visitor - intriguing message
					const greetings = [
						`First visit detected`,
						`New visitor identified`,
						`Welcome, stranger`
					];
					msg = `<strong>${greetings[Math.floor(Math.random() * greetings.length)]}</strong>`;
				} else if (visitCount === 2) {
					msg = `You came back! Visit <strong>#${visitCount}</strong>`;
				} else if (visitCount < 5) {
					msg = `Welcome back! Visit <strong>#${visitCount}</strong>`;
				} else if (visitCount < 10) {
					msg = `Hey there, regular! Visit <strong>#${visitCount}</strong>`;
				} else if (visitCount < 25) {
					msg = `You're basically family now. Visit <strong>#${visitCount}</strong>`;
				} else {
					msg = `Legend status achieved. Visit <strong>#${visitCount}</strong>`;
				}

				// Add a fun detail
				const details = [];
				if (city && visitCount > 1) details.push(`from ${city}`);
				
				if (hour < 6) details.push('midnight session');
				else if (hour < 9) details.push('early riser');
				else if (hour >= 22) details.push('night owl');

				if (details.length > 0) {
					msg += ` • ${details[0]}`;
				}

				return msg;
			}

			// Gather all available data about the visitor
			function getTimeSince(date) {
				const seconds = Math.floor((new Date() - date) / 1000);
				if (seconds < 60) return seconds + 's';
				const minutes = Math.floor(seconds / 60);
				if (minutes < 60) return minutes + 'm';
				const hours = Math.floor(minutes / 60);
				if (hours < 24) return hours + 'h';
				const days = Math.floor(hours / 24);
				return days + 'd';
			}

			function getGPU() {
				try {
					const canvas = document.createElement('canvas');
					const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
					if (gl) {
						const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
						if (debugInfo) {
							return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
						}
					}
				} catch (e) {}
				return null;
			}

			function createModule(title, content, delay = 0, fullWidth = false) {
				return `
					<div class="hud-module${fullWidth ? ' full-width' : ''}" style="animation: slideIn 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) ${delay}s forwards; opacity: 0; transform: translateY(20px);">
						<div class="module-header">
							<span>${title}</span>
							<div style="width: 6px; height: 6px; background: ${fullWidth ? '#00ff88' : '#fff'}; border-radius: 50%; opacity: ${fullWidth ? '1' : '0.3'};"></div>
						</div>
						${content}
					</div>
				`;
			}

			function createDetail(label, value) {
				return `
					<div class="hud-detail">
						<span class="hud-label">${label}</span>
						<span style="color: #fff;">${value}</span>
					</div>
				`;
			}

			function showDataOverlay() {
				const overlay = document.getElementById('data-overlay');
				const content = document.getElementById('data-content');
				
				const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
				const city = tz.split('/').pop().replace(/_/g, ' ');
				const gpu = getGPU();
				
				// System info
				const platform = navigator.platform;
				const cores = navigator.hardwareConcurrency || 2;
				const memory = navigator.deviceMemory || 4;
				const screenRes = `${window.innerWidth}×${window.innerHeight}`;
				
				// Referrer info
				const referrer = document.referrer;
				const referrerDomain = referrer ? new URL(referrer).hostname.replace('www.', '') : null;
				const urlParams = new URLSearchParams(window.location.search);
				const utmSource = urlParams.get('utm_source');
				const utmMedium = urlParams.get('utm_medium');
				const utmCampaign = urlParams.get('utm_campaign');
				
				// Session start time
				if (!window.sessionStartTime) window.sessionStartTime = Date.now();
				const sessionDuration = Math.floor((Date.now() - window.sessionStartTime) / 1000);
				
				// Browser info
				const browserInfo = (function() {
					const ua = navigator.userAgent;
					if (ua.includes('Firefox')) return 'Firefox';
					if (ua.includes('Edg')) return 'Edge';
					if (ua.includes('Chrome')) return 'Chrome';
					if (ua.includes('Safari')) return 'Safari';
					return 'Unknown';
				})();
				
				// Engagement score (0-100)
				const engagementScore = Math.min(100, Math.floor(
					(visitCount * 15) + 
					(sessionDuration > 30 ? 20 : sessionDuration * 0.5) +
					(referrer ? 10 : 0) +
					(utmSource ? 15 : 0)
				));
				
				let html = '';

				// SVG gradient definition (hidden)
				html += `
					<svg width="0" height="0" style="position: absolute;">
						<defs>
							<linearGradient id="engagementGradient" x1="0%" y1="0%" x2="100%" y2="0%">
								<stop offset="0%" style="stop-color:#00ff88"/>
								<stop offset="100%" style="stop-color:#00d4ff"/>
							</linearGradient>
						</defs>
					</svg>
				`;

				// Header with scan line effect
				html += `
					<div style="position: relative; display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
						<div class="scan-line"></div>
						<div>
							<div class="live-indicator" style="margin-bottom: 8px;">
								<span class="live-dot"></span>
								<span>LIVE TRACE ACTIVE</span>
							</div>
							<div style="font-size: 36px; font-weight: 700; color: #fff; letter-spacing: -1px;">Visitor Identity</div>
							<div style="font-size: 12px; color: rgba(255,255,255,0.4); margin-top: 4px;">Real-time visitor intelligence dashboard</div>
						</div>
						<div style="text-align: right;">
							<div style="font-size: 11px; color: rgba(255,255,255,0.5); font-family: monospace;">ID: ${Math.random().toString(36).substr(2, 9).toUpperCase()}</div>
							<div style="font-size: 11px; color: #00ff88; margin-top: 4px;">● SECURE CONNECTION</div>
						</div>
					</div>
				`;

				html += `<div class="hud-grid">`;

				// 1. Engagement Score Module
				const engagementContent = `
					<div class="engagement-ring">
						<svg width="80" height="80" viewBox="0 0 80 80">
							<circle class="ring-bg" cx="40" cy="40" r="35"/>
							<circle class="ring-fill" cx="40" cy="40" r="35" style="stroke-dashoffset: ${220 - (220 * engagementScore / 100)};"/>
						</svg>
						<div class="engagement-value">${engagementScore}</div>
					</div>
					<div style="text-align: center; margin-bottom: 15px;">
						<div class="hud-label">ENGAGEMENT SCORE</div>
					</div>
					${createDetail('VISIT DEPTH', visitCount > 5 ? 'Power User' : visitCount > 2 ? 'Returning' : 'New')}
					${createDetail('SESSION TIME', sessionDuration + 's')}
					${createDetail('BROWSER', browserInfo)}
				`;
				html += createModule('ENGAGEMENT', engagementContent, 0);

				// 2. Location Module (Globe)
				const locationContent = `
					<div class="globe-container">
						<div class="css-globe">
							<div class="globe-dot"></div>
						</div>
					</div>
					<div style="text-align: center;">
						<div class="hud-value">${city || 'Unknown'}</div>
						<div class="hud-label">${tz}</div>
					</div>
					<div class="stat-bar">
						<div class="stat-fill" style="width: 100%; background: #00ff88; box-shadow: 0 0 10px #00ff88;"></div>
					</div>
					<div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 10px; color: rgba(255,255,255,0.4);">
						<span>LAT: ${(Math.random()*180-90).toFixed(4)}</span>
						<span>LNG: ${(Math.random()*360-180).toFixed(4)}</span>
					</div>
				`;
				html += createModule('GEOLOCATION', locationContent, 0.1);

				// 3. Acquisition Module (Referrer/UTM)
				const sourceIcons = {
					google: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
					linkedin: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>`,
					twitter: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><path d="M4 4l11.733 16h4.267l-11.733 -16z"/><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"/></svg>`,
					github: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>`,
					link: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>`,
					globe: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>`
				};
				
				let sourceIcon;
				if (!referrerDomain) {
					sourceIcon = sourceIcons.globe;
				} else if (referrerDomain.includes('google')) {
					sourceIcon = sourceIcons.google;
				} else if (referrerDomain.includes('linkedin')) {
					sourceIcon = sourceIcons.linkedin;
				} else if (referrerDomain.includes('twitter') || referrerDomain.includes('x.com')) {
					sourceIcon = sourceIcons.twitter;
				} else if (referrerDomain.includes('github')) {
					sourceIcon = sourceIcons.github;
				} else {
					sourceIcon = sourceIcons.link;
				}
				
				const acquisitionContent = `
					<div style="text-align: center; margin-bottom: 15px;">
						<div style="margin-bottom: 8px;">${sourceIcon}</div>
						<div class="hud-value" style="font-size: 16px;">${referrerDomain || 'Direct Visit'}</div>
						<div class="hud-label">TRAFFIC SOURCE</div>
					</div>
					${utmSource ? createDetail('UTM SOURCE', utmSource) : ''}
					${utmMedium ? createDetail('UTM MEDIUM', utmMedium) : ''}
					${utmCampaign ? createDetail('UTM CAMPAIGN', utmCampaign) : ''}
					${!utmSource && !utmMedium && !utmCampaign ? createDetail('CAMPAIGN', 'No tracking params') : ''}
					${createDetail('LANDING PAGE', window.location.pathname || '/')}
				`;
				html += createModule('ACQUISITION', acquisitionContent, 0.15);

				// 4. Session Module with Timeline
				const sessionContent = `
					<div style="display: flex; gap: 20px; margin-bottom: 15px;">
						<div>
							<div class="hud-value count-up">#${visitCount}</div>
							<div class="hud-label">VISITS</div>
						</div>
						<div>
							<div class="hud-value">${new Date().getHours()}:${String(new Date().getMinutes()).padStart(2, '0')}</div>
							<div class="hud-label">LOCAL TIME</div>
						</div>
					</div>
					<div class="session-timeline">
						<div class="timeline-event">
							<div>Viewing page now</div>
							<div class="timeline-time">Just now</div>
						</div>
						${lastVisit ? `<div class="timeline-event">
							<div>Previous visit</div>
							<div class="timeline-time">${getTimeSince(new Date(lastVisit))} ago</div>
						</div>` : ''}
						<div class="timeline-event">
							<div>First discovered site</div>
							<div class="timeline-time">${visitCount === 1 ? 'Today' : 'Earlier'}</div>
						</div>
					</div>
				`;
				html += createModule('SESSION TIMELINE', sessionContent, 0.2);

				// 5. System Module
				let gpuName = gpu ? (gpu.length > 25 ? gpu.substring(0, 22) + '...' : gpu) : 'INTEGRATED';
				const systemContent = `
					<div style="margin-bottom: 15px;">
						<div class="hud-value" style="font-size: 18px;">${platform}</div>
						<div class="hud-label">OPERATING SYSTEM</div>
					</div>
					${createDetail('CPU CORES', cores)}
					${createDetail('MEMORY', memory + ' GB')}
					${createDetail('RESOLUTION', screenRes)}
					${createDetail('GPU', gpuName)}
					<div class="stat-bar" style="margin-top: 15px;">
						<div class="stat-fill" style="width: ${Math.min(100, (memory/16)*100)}%;"></div>
					</div>
				`;
				html += createModule('SYSTEM ARCHITECTURE', systemContent, 0.25);

				// 6. Network & Privacy
				const conn = navigator.connection || { effectiveType: '4g', downlink: 10 };
				const privacyScore = (navigator.doNotTrack === '1' ? 80 : 40) + (navigator.cookieEnabled ? 0 : 20);
				
				const networkContent = `
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
						<div style="background: rgba(255,255,255,0.05); padding: 10px; text-align: center; border-radius: 4px;">
							<div style="font-size: 18px; color: #fff;">${conn.effectiveType.toUpperCase()}</div>
							<div style="font-size: 10px; color: rgba(255,255,255,0.4);">TYPE</div>
						</div>
						<div style="background: rgba(255,255,255,0.05); padding: 10px; text-align: center; border-radius: 4px;">
							<div style="font-size: 18px; color: #fff;">${conn.downlink || '?'}</div>
							<div style="font-size: 10px; color: rgba(255,255,255,0.4);">MBPS</div>
						</div>
					</div>
					${createDetail('DO NOT TRACK', navigator.doNotTrack === '1' ? 'ENABLED' : 'DISABLED')}
					${createDetail('COOKIES', navigator.cookieEnabled ? 'ALLOWED' : 'BLOCKED')}
					${createDetail('PRIVACY SCORE', privacyScore + '/100')}
				`;
				html += createModule('NETWORK TELEMETRY', networkContent, 0.3);

				// 7. PUBLIC ANALYTICS MODULE - Full width PostHog embed
				const analyticsContent = `
					<div style="margin-bottom: 15px;">
						<div style="display: flex; justify-content: space-between; align-items: center;">
							<div>
								<div class="hud-value" style="font-size: 18px;">All Visitors</div>
								<div class="hud-label">Aggregated site analytics • Updated live</div>
							</div>
							<div class="live-indicator">
								<span class="live-dot"></span>
								<span>LIVE</span>
							</div>
						</div>
					</div>
					<div class="analytics-embed-container" style="padding-top: 0; min-height: 450px;">
						<iframe 
							src="https://us.posthog.com/embedded/7G3XwVWhK5gpZ59EArOECsDY-rwgcA" 
							class="analytics-embed"
							style="position: relative; width: 100%; height: 450px;"
							allowfullscreen
							loading="lazy"
						></iframe>
					</div>
					<div style="margin-top: 15px; display: flex; justify-content: space-between; font-size: 10px; color: rgba(255,255,255,0.4);">
						<span>Powered by PostHog</span>
						<span>Public aggregate data only</span>
					</div>
				`;
				html += createModule('PUBLIC ANALYTICS', analyticsContent, 0.4, true);

				html += `</div>`; // End grid

				// Footer
				html += `
					<div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
						<div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 8px;">
							This data is collected to understand site visitors. No personal information is stored.
						</div>
						<div style="font-size: 10px; color: rgba(255,255,255,0.3); letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 6px;">
							<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
							PRIVACY-FIRST ANALYTICS • NO COOKIES FOR TRACKING • GDPR COMPLIANT
						</div>
					</div>
				`;

				content.innerHTML = html;
				overlay.classList.add('show');
				
				if (window.posthog) {
					posthog.capture('data_overlay_viewed', { visit_count: visitCount });
				}
			}

			function hideDataOverlay() {
				document.getElementById('data-overlay').classList.remove('show');
			}

			// Show toast
			function showToast() {
				const toast = document.getElementById('visitor-toast');
				const message = document.getElementById('toast-message');
				const closeBtn = document.getElementById('toast-close');
				const toastContent = document.getElementById('toast-content');
				const overlay = document.getElementById('data-overlay');
				const closeData = document.getElementById('close-data');
				const toastIcon = toast.querySelector('.toast-icon');

				// Dynamic icon based on visit count (using SVG icons)
				const icons = {
					scan: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
					wave: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`,
					star: `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>`,
					trophy: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`
				};
				
				if (visitCount === 1) {
					toastIcon.innerHTML = icons.scan;
				} else if (visitCount < 5) {
					toastIcon.innerHTML = icons.wave;
				} else if (visitCount < 15) {
					toastIcon.innerHTML = icons.star;
				} else {
					toastIcon.innerHTML = icons.trophy;
				}

				message.innerHTML = getMessage();

				// Show immediately
				toast.classList.add('show');

				// Auto-hide after 12 seconds
				let autoHide = setTimeout(() => {
					toast.classList.remove('show');
				}, 12000);

				// Click toast content to show data
				toastContent.addEventListener('click', (e) => {
					clearTimeout(autoHide);
					toast.classList.remove('show');
					showDataOverlay();
				});

				// Close button
				closeBtn.addEventListener('click', (e) => {
					e.stopPropagation();
					clearTimeout(autoHide);
					toast.classList.remove('show');
					
					if (window.posthog) {
						posthog.capture('toast_dismissed', { visit_count: visitCount });
					}
				});

				// Close data overlay
				closeData.addEventListener('click', hideDataOverlay);
				overlay.addEventListener('click', (e) => {
					if (e.target === overlay) hideDataOverlay();
				});
				document.addEventListener('keydown', (e) => {
					if (e.key === 'Escape') hideDataOverlay();
				});
			}

			// Show toast - only on 2nd+ visit, handle case where page is already loaded
			if (visitCount >= 2) {
				if (document.readyState === 'complete') {
					showToast();
				} else {
					window.addEventListener('load', showToast);
				}
			}
		})();
		</script>
	</body>
</html>
